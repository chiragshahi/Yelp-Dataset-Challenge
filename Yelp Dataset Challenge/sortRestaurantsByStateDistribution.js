var fs = require('fs'),
    es = require('event-stream'),
    JSONStream = require('JSONStream')
    _ = require('lodash');
var dict = { 
  '4': 0,
  '6': 0,
  '10': 0,
  '11': 0,
  '45': 0,
  'AB': 0,
  'NV': 0,
  'QC': 0,
  'AZ': 0,
  'ON': 0,
  'PA': 0,
  'OH': 0,
  'IL': 0,
  'WI': 0,
  'NC': 0,
  'BY': 0,
  'NYK': 0,
  'SC': 0,
  'C': 0,
  'XGM': 0,
  'ST': 0,
  'IN': 0,
  'RP': 0,
  'CMA': 0,
  'NI': 0,
  'NLK': 0,
  'VS': 0,
  'CO': 0,
  'HE': 0,
  'VA': 0,
  'RCC': 0,
  '01': 0,
  'SG': 0,
  'NY': 0,
  'OR': 0,
  'NW': 0,
  'CC': 0,
  'CA': 0,
  'LU': 0,
  'MT': 0,
  'G': 0,
  'PO': 0,
  'B': 0,
  'VT': 0,
  'AL': 0,
  'WAR': 0,
  'MO': 0,
  'HU': 0,
  'M': 0,
  'AR': 0,
  'O': 0,
  'FL': 0,
  'WA': 0,
  'KY': 0,
  'CRF': 0,
  'TAM': 0,
  'NE': 0,
  'XMS': 0,
  'GA': 0,
  'AG': 0,
  'WHT': 0,
  'MA': 0,
  'V': 0,
  'BC': 0,
  'SP': 0,
  'DE': 0,
  'HH': 0,
  'CS': 0,
  'MN': 0
};

var getStream = function () {
    var jsonData = 'yelp_academic_dataset_business.json',
        stream = fs.createReadStream(jsonData, {encoding: 'utf8'}),
        parser = JSONStream.parse();
        return stream.pipe(parser);
}

getStream().pipe(es.mapSync(function (data) {
    dict[data['state']] += data['review_count'];
    //console.log(arr);
})).on('end', () => {
    console.log(dict);
    //console.log(_.countBy(arr));
    //console.log('finished');    
    //console.log(arr.length);
});



/*
Total buisness = 188593
Total Reviews ~ 6 million
Output : 
{ '4': 1,
  '6': 3,
  '10': 1,
  '11': 1,
  '45': 1,
  AB: 7670,
  NV: 35688,
  QC: 8756,
  AZ: 56495,
  ON: 32393,
  PA: 10966,
  OH: 13664,
  IL: 1937,
  WI: 5042,
  NC: 14359,
  BY: 60,
  NYK: 163,
  SC: 770,
  C: 34,
  XGM: 23,
  ST: 45,
  IN: 101,
  RP: 19,
  CMA: 2,
  NI: 134,
  NLK: 23,
  VS: 7,
  CO: 43,
  HE: 32,
  VA: 1,
  RCC: 1,
  '01': 11,
  SG: 2,
  NY: 19,
  OR: 72,
  NW: 4,
  CC: 1,
  CA: 8,
  LU: 1,
  MT: 1,
  G: 2,
  PO: 1,
  B: 2,
  VT: 2,
  AL: 2,
  WAR: 1,
  MO: 2,
  HU: 1,
  M: 2,
  AR: 2,
  O: 3,
  FL: 1,
  WA: 2,
  KY: 1,
  CRF: 1,
  TAM: 1,
  NE: 1,
  XMS: 1,
  GA: 1,
  AG: 1,
  WHT: 1,
  MA: 1,
  V: 1,
  BC: 1,
  SP: 1,
  DE: 1,
  HH: 1,
  CS: 1,
  MN: 1 }
*/

/*
{ '4': 3,
  '6': 10,
  '10': 3,
  '11': 3,
  '45': 7,
  AB: 90456,
  NV: 2083648,
  QC: 161911,
  AZ: 1877476,
  ON: 706947,
  PA: 260322,
  OH: 274898,
  IL: 39354,
  WI: 121047,
  NC: 360666,
  BY: 406,
  NYK: 784,
  SC: 13202,
  C: 236,
  XGM: 196,
  ST: 293,
  IN: 1278,
  RP: 106,
  CMA: 9,
  NI: 1024,
  NLK: 102,
  VS: 28,
  CO: 394,
  HE: 216,
  VA: 3,
  RCC: 8,
  '01': 42,
  SG: 17,
  NY: 150,
  OR: 1122,
  NW: 38,
  CC: 3,
  CA: 68,
  LU: 3,
  MT: 12,
  G: 16,
  PO: 5,
  B: 10,
  VT: 8,
  AL: 8,
  WAR: 3,
  MO: 8,
  HU: 3,
  M: 13,
  AR: 19,
  O: 9,
  FL: 17,
  WA: 39,
  KY: 3,
  CRF: 6,
  TAM: 14,
  NE: 4,
  XMS: 3,
  GA: 3,
  AG: 8,
  WHT: 3,
  MA: 14,
  V: 3,
  BC: 3,
  SP: 10,
  DE: 5,
  HH: 15,
  CS: 3,
  MN: 4 }
